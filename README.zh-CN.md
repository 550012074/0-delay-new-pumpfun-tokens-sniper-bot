# Pump.fun 新代幣狙擊腳本 – 完整文檔
🌐 語言：[英文](README.md) | [中文](README.zh-CN.md) | [日文](README.ja.md) | [韓國文](README.kr.md) | [俄文](README.ru.md)

📋 **專案概述**
這是一個使用 TypeScript 開發的 Pump.fun 新代幣狙擊腳本。
它透過高效能 gRPC 串流傳輸檢索新代幣訊息，獲取代幣發佈時間，並將其與當前系統時間進行比較。
透過儘早執行買入訂單，它允許您與開發者同時購買。
如果時間閾值足夠低，它甚至可以實現與開發者相同的時段購買。

---

🎯 **核心功能**

1. **實時代幣監控**
- 資料來源：SolanaStreaming WebSocket API
- 監控範圍：Pump.fun 上新上線的代幣
- 回應時間：偵測到新代幣後立即分析

2. **智能時間過濾**
- 時間閾值：900 毫秒（可設定）
- 濾波邏輯：僅處理上線時間差≤900 毫秒的代幣
- 目標：確保與開發者同時買入

3. **自動交易策略**
- 偵測新代幣 → 立即買入 → 等待 500 毫秒 → 賣出 70% → 等待 1500 毫秒 → 賣出 100%

4. **交易確認機制**
- 買入確認：透過 QuickNode RPC 驗證交易狀態
- 賣出確認：無限次重試至成功（確保無剩餘部位）
- 失敗處理：自動重試與錯誤日誌

---

🏗️ **技術架構**

**核心技術堆疊**

1. **日誌系統**
```ts
class Logger {
info() // 資訊日誌
success() // 成功日誌
error() // 錯誤日誌
warning() // 警告日誌
debug() // 偵錯日誌
}
```

2. **狀態管理**
- 全域鎖定：`isProcessing` 確保序列執行
- 重複預防：`seenMints` 設定避免重複處理
- 效能追蹤：`tradeTimings` Map 記錄交易時長

3. **WebSocket 連線管理**
- 自動重連：指數退避演算法
- 心跳：20 秒 ping，30 秒健康檢查
- 優雅關閉：進程退出時的訊號處理

---

⚙️ **配置參數**

**環境變數**

『`bash
# 錢包配置
PUBLIC_KEY=你的錢包公鑰
PRIVATE_KEY=你的錢包私鑰

# 交易參數
BUY_SOL=0.5 # 買入數量 (SOL)
BUY_SLIPPAGE=1000 # 買進滑點 (%)
SELL1_SLIPPAGE=1000 # 賣出 70% 的滑點
SELL2_SLIPPAGE=1000 # 賣出 100% 的滑點
PRIORITY_FEE=0.00000000005 # 優先手續費 (SOL)
POOL=pump # 交易池

# 時間設定
EVENT_TIMEOUT_MS=900 # 時間閾值 (ms)
FIRST_SELL_DELAY_MS=500 # 賣出 70% 前的延遲時間 (ms)
SECOND_SELL_DELAY_MS=1500 # 賣出前的延遲時間100%（毫秒）

# API 配置
# 在 https://solanastreaming.com/ 申請 SolanaStreaming WebSocket API 金鑰
SOLANA_STREAMING_API_KEY=
```

**支援的礦池**
- `pump` - Pump.fun 主礦池
- `raydium` - Raydium DEX
- `pump-amm` - Pump AMM
- `launchlab` - LaunchLab
- `raydium-cpmm` - Raydium CPMM
- `bonk` - Bonk 礦池
- `auto` - 自動選擇

---

🔄 **工作流程**

1. **初始化**
載入設定 → 建立連線 → 啟動 WebSocket → 訂閱新代幣事件

2. **監控**
接收 WebSocket 訊息 → 解析代幣資訊 → 計算時間差 → 決定是否交易

3. **交易**
買入 → 確認 → 等待 500 毫秒 → 賣出 70% → 等待 1500 毫秒 → 賣出 100% → 確認

4. **錯誤處理**
交易失敗 → 自動重試 → 繼續監控

---

📊 **效能監控**

- **時間統計**
- 買入時長：從買入開始到首次賣出的時間
- 賣出 70% 時長：賣出 70% 的執行時間
- 賣出 100% 時長：賣出 100% 的執行時間
- 總長度：完整交易週期

- **日誌記錄**
- 控制台輸出：即時交易狀態
- 日誌檔：`./logs/sniper_YYYY-MM-DD.log`
- 統計檔案：`./logs/stats_YYYY-MM-DD.json`

---

🛡️ **安全功能**

1. **重複預防**
- 使用 Set 記錄已處理的鑄幣地址
- 避免重複交易同一代幣

2. **串行執行**
- 全域鎖定確保一次只處理一個代幣
- 防止併發相關問題

3. **錯誤恢復**
- 自動重連機制
- 交易失敗時自動重試
- 優雅的錯誤處理

---

📈 **交易策略詳情**

**買進策略**
- 條件：偵測到的代幣時間差≤900毫秒（可在 `.env` 中設定）
- 數量：固定 SOL 數量（預設 0.5 SOL）
- 滑點：低滑點，最優價格
- 確認：等待交易確認後再繼續

**賣出策略**
- 拆分賣出：70% + 100%（兩階段）
- 時機： 500 毫秒和 1500 毫秒延遲
- 重試：無限次重試至成功
- 滑點控制：
- 低滑點，最高可達 70%（至
